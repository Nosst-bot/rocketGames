<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Registro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Agrega tu hoja de estilos para “pisar” colores de Bootstrap -->
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6">
        <div class="card shadow">
          <div class="card-body">
            <!-- Título sin cambios; si quisieras amarillo del sitio, puedes envolver con <span class="text-warning">Rocket Games</span> -->
            <h1 class="h4 mb-3 text-center">Registro en Rocket Games</h1>

            <form id="registroForm">
              <div class="mb-3">
                <label class="form-label" for="nombre">Nombre</label>
                <input id="nombre" class="form-control" required maxlength="50">
              </div>

              <div class="mb-3">
                <label class="form-label" for="correo">Correo</label>
                <input id="correo" type="email" class="form-control" required maxlength="50"
                       placeholder="tucorreo@gmail.com">
                <!-- Si quieres restringir dominios, agrega: pattern="^[^@\\s]+@(?:duoc\\.cl|profesor\\.duoc\\.cl|gmail\\.com)$" -->
              </div>

              <div class="mb-3">
                <label class="form-label" for="pass">Contraseña</label>
                <input id="pass" type="password" class="form-control" minlength="6" required>
              </div>

              <!-- Región / Comuna opcionales y simples -->
              <div class="row g-2 mb-3">
                <div class="col-md-6">
                  <label class="form-label" for="region">Región (opcional)</label>
                  <select id="region" class="form-select">
                    <option value="">Selecciona...</option>
                    <option>Región Metropolitana</option>
                    <option>Valparaíso</option>
                    <option>Biobío</option>
                    <option>La Araucanía</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="comuna">Comuna (opcional)</label>
                  <select id="comuna" class="form-select" disabled>
                    <option value="">Selecciona...</option>
                  </select>
                </div>
              </div>

              <div id="regError" class="alert alert-danger d-none"></div>
              <div id="regOk" class="alert alert-success d-none">Registro exitoso</div>

              <!--  Usa btn-danger para que tome el rojo del sitio (lo puedes “pisar” en styles.css) -->
              <button type="submit" class="btn btn-danger w-100">Registrarme</button>
            </form>

            <hr>
            <p class="text-center">
              <!-- Puedes dar estilo de link acorde al sitio: al tener fondo negro, esta clase mantiene el look -->
              <a href="login.html" class="nav-modern">Volver al login</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Tu store de auth -->
  <script src="js/auth.js"></script>

  <script>
  $(function () {
    // pre-rellena correo si venimos desde login con ?email=
    const params = new URLSearchParams(location.search);
    if (params.has('email')) $('#correo').val(params.get('email'));

    // Región -> Comunas (muy simple)
    const comunasPorRegion = {
      "Región Metropolitana": ["Santiago","Providencia","Las Condes","Maipú"],
      "Valparaíso": ["Valparaíso","Viña del Mar","Quilpué","Villa Alemana"],
      "Biobío": ["Concepción","Talcahuano","Chiguayante","San Pedro de la Paz"],
      "La Araucanía": ["Temuco","Padre Las Casas","Angol","Villarrica"]
    };
    $('#region').on('change', function(){
      const region = $(this).val();
      const $comuna = $('#comuna').prop('disabled', true).empty()
        .append('<option value="">Selecciona...</option>');
      (comunasPorRegion[region] || []).forEach(c =>
        $comuna.append(`<option>${c}</option>`));
      if (comunasPorRegion[region]?.length) $comuna.prop('disabled', false);
    });

    // Validación nativa HTML5 (como te expliqué) + flujo de registro
    $('#registroForm').on('submit', function (e) {
      if (!this.checkValidity()) {
        this.reportValidity();
        e.preventDefault();
        return;
      }
      e.preventDefault();
      const resp = AuthStore.registerUser({
        name: $('#nombre').val(),
        email: $('#correo').val(),
        pass: $('#pass').val()
      });

      if (!resp.ok) {
        $('#regError').removeClass('d-none').text(resp.message);
        $('#regOk').addClass('d-none');
        return;
      }
      $('#regError').addClass('d-none');
      $('#regOk').removeClass('d-none').text('Registro exitoso. Redirigiendo…');
      setTimeout(() => window.location.href = resp.dest || 'login.html', 800);
    });
  });
  </script>
</body>
</html>
